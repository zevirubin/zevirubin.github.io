<!DOCTYPE html>
<html>
    <head>
        <script>
			//pass function an xml doc to load
            function loadXMLDoc(filename)
            {
                if (window.XMLHttpRequest)
                {
                    xhttp=new XMLHttpRequest();
                }
                else // code for IE5 and IE6
                {
                    xhttp=new ActiveXObject("Microsoft.XMLHTTP");
                }
                xhttp.open("GET",filename,false);
                xhttp.send();
                return xhttp.responseXML;
            }
        </script>
        <script type="text/javascript" src="../d3/d3.v3.min.js"></script>
		<style type="text/css">
            .navigator .data
			{
				fill: lightgrey;
				stroke-width: 0px;
			}
			.navigator .line
			{
				fill: none;
				stroke: black;
				stroke-width: 1px;
			}
			.navigator .viewport
			{
				stroke: grey;
				fill: black;
				fill-opacity: 0.4;
			}
			.chart
            {
                background: #fff;
                font: 10px sans-serif;
                shape-rendering: crispEdges;
            }
            .chart text
            {
                fill: black;
            }
            .axis line, .axis path
            {
                fill: none;
                stroke: #000;
                shape-rendering: crispEdges;
            }
            path
            {
				fill: none;
			}
            .axis text
            {
                text-shadow: 0 1px 0 #fff;
                cursor: move;
            }
			.dropdown
			{
				left: -120px;
				top: 10px;
			}
		</style>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    </head>
    <body>
		<div class="container">                                          
			<div class="dropdown">
				<button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">Options
					<span class="caret"></span></button>
				<ul class="dropdown-menu" role="menu" aria-labelledby="menu1">
					<li value=1 role="presentation"><a id="coloryear" role="menuitem" tabindex="-1" href="#">Color By Year </a></li>
					<li value=2 role="presentation"><a id="linethick" role="menuitem" tabindex="-1" href="#">Line Thickness</a></li>
					<li value=3 role="presentation"><a id="crossing" role="menuitem" tabindex="-1" href="#">Don't Cross</a></li>
					<li value=4 role="presentation"><a id="scrolling" role="menuitem" tabindex="-1" href="#">Don't Scroll</a></li>
				</ul>
			</div>
		</div>
		
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script>
			colorByYear = true;
			lineThickness = true;
			dontCross = true;
			dontscroll = false;
			//Get data from xml file containing attributes
			function loadAttributeFile()
			{
				//load in attribute file
				xmlDoc=loadXMLDoc("starattributes.xml");
				
				//array to contain attributes for each person
				fieldvalues = []
				
				//number of attributes is (number of children - 2)
				//the subtracted two represent name and key
				num_attributes = xmlDoc.getElementsByTagName('TITLE')[1].children.length-2;
            
				//store names and keys in arrays
				names = xmlDoc.getElementsByTagName("NAME");
				key = xmlDoc.getElementsByTagName("KEY");
				
				//create arrays to store all attributes
				for(var j = 0; j < num_attributes; j++)
				{
				    var varName = "att" + j;
					var tagname = "ATTRIBUTE" + j;
					window[varName] = xmlDoc.getElementsByTagName(tagname);
				}
						
				for(var i = 0; i < names.length; i++)
				{
					//temporary array to store name, key, and all attributes corresponding to person
					var temp = []
					//store name and key
	                temp.push(names[i].childNodes[0].nodeValue);
	                temp.push(key[i].childNodes[0].nodeValue);
					
					//store attributes
					for(var j = 0; j < num_attributes; j++)
					{
						var varName = "att" + j;
						temp.push(window[varName][i].childNodes[0].nodeValue);
					}
				//add blank array that will eventually contain year and rank info to be graphed				
                temp.push([]);
				//add single person array to array that stores all person data
                fieldvalues.push(temp);
				}
			}
            
			//read in ranking and year data
			function loadRankingData()
			{
				//open file with year and key info
				xmlDoc2=loadXMLDoc("masterkey.xml");
				//store the number of years we're working with
				var numyear = xmlDoc2.getElementsByTagName("YEAR").length;
				
				//create arrays to temporarily store all data
				var year = []
				var rank1 = []
				var rank2 = []
				var rank3 = []
				var rank4 = []
				var rank5 = []
				var rank6 = []
				var rank7 = []
				var rank8 = []
				var rank9 = []
				var rank10 = []
				
				//get all years from xml, store in array
				var temparray = xmlDoc2.getElementsByTagName("YEAR");
				for(var i = 0; i < numyear; i++)
				{
				    year.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number one ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK1");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank1.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number two ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK2");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank2.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number three ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK3");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank3.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number four ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK4");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank4.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number five ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK5");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank5.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number six ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK6");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank6.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number seven ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK7");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank7.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number eight ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK8");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank8.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number nine ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK9");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank9.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number ten ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK10");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank10.push(temparray[i].childNodes[0].nodeValue);
				}
				
				//store rank for each year data with other attribute data
				for(var k = 0; k < year.length; k++)
				{
		            //rank_[k] is key value for person at that rank in that year, subtract one to find index that person is stored at
					//(fieldvalues[0].length)-1 gives the last position of the array of attributes, the empty array
					//push new data into the empty array in the form of [year, rank]
					fieldvalues[rank1[k]-1][(fieldvalues[0].length)-1].push([year[k],1]);
		            fieldvalues[rank2[k]-1][fieldvalues[0].length-1].push([year[k],2]);
		            fieldvalues[rank3[k]-1][fieldvalues[0].length-1].push([year[k],3]);
		            fieldvalues[rank4[k]-1][fieldvalues[0].length-1].push([year[k],4]);
		            fieldvalues[rank5[k]-1][fieldvalues[0].length-1].push([year[k],5]);
					fieldvalues[rank6[k]-1][fieldvalues[0].length-1].push([year[k],6]);
		            fieldvalues[rank7[k]-1][fieldvalues[0].length-1].push([year[k],7]);
		            fieldvalues[rank8[k]-1][fieldvalues[0].length-1].push([year[k],8]);
		            fieldvalues[rank9[k]-1][fieldvalues[0].length-1].push([year[k],9]);
		            fieldvalues[rank10[k]-1][fieldvalues[0].length-1].push([year[k],10]);
		        }
			}
			
			function loadRankingDataNoCross()
			{
				//open file with year and key info
				xmlDoc2=loadXMLDoc("masterkey.xml");
				//store the number of years we're working with
				var numyear = xmlDoc2.getElementsByTagName("YEAR").length;
				
				//create arrays to temporarily store all data
				var year = []
				var rank1 = []
				var rank2 = []
				var rank3 = []
				var rank4 = []
				var rank5 = []
				var rank6 = []
				var rank7 = []
				var rank8 = []
				var rank9 = []
				var rank10 = []
				
				//get all years from xml, store in array
				var temparray = xmlDoc2.getElementsByTagName("YEAR");
				for(var i = 0; i < numyear; i++)
				{
				    year.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number one ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK1");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank1.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number two ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK2");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank2.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number three ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK3");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank3.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number four ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK4");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank4.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number five ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK5");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank5.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number six ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK6");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank6.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number seven ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK7");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank7.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number eight ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK8");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank8.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number nine ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK9");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank9.push(temparray[i].childNodes[0].nodeValue);
				}
				//get all number ten ranked from xml, store in array
				temparray = xmlDoc2.getElementsByTagName("RANK10");
				for(var i = 0; i < temparray.length; i++)
				{
				    rank10.push(temparray[i].childNodes[0].nodeValue);
				}
				
				for(var a = 0; a < fieldvalues.length; a++)
				{
					for(var b = 0; b < year.length; b++)
					{
						fieldvalues[a][(fieldvalues[0].length)-1].push([year[b], null]);
					}
				}
				
				//store rank for each year data with other attribute data
				for(var k = 0; k < year.length; k++)
				{
		            //rank_[k] is key value for person at that rank in that year, subtract one to find index that person is stored at
					//(fieldvalues[0].length)-1 gives the last position of the array of attributes, the empty array
					//push new data into the empty array in the form of [year, rank]
					
					for(var a = 0; a < fieldvalues[rank1[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank1[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank1[k]-1][(fieldvalues[0].length)-1][a] = [year[k],1];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank2[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank2[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank2[k]-1][(fieldvalues[0].length)-1][a] = [year[k],2];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank3[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank3[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank3[k]-1][(fieldvalues[0].length)-1][a] = [year[k],3];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank4[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank4[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank4[k]-1][(fieldvalues[0].length)-1][a] = [year[k],4];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank5[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank5[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank5[k]-1][(fieldvalues[0].length)-1][a] = [year[k],5];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank6[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank6[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank6[k]-1][(fieldvalues[0].length)-1][a] = [year[k],6];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank7[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank7[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank7[k]-1][(fieldvalues[0].length)-1][a] = [year[k],7];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank2[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank8[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank8[k]-1][(fieldvalues[0].length)-1][a] = [year[k],8];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank9[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank9[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank9[k]-1][(fieldvalues[0].length)-1][a] = [year[k],9];
						}
					}
					
					for(var a = 0; a < fieldvalues[rank10[k]-1][(fieldvalues[0].length)-1].length; a++)
					{
						if (fieldvalues[rank10[k]-1][(fieldvalues[0].length)-1][a][0] == year[k])
						{
							fieldvalues[rank10[k]-1][(fieldvalues[0].length)-1][a] = [year[k],10];
						}
					}
		        }		
		
			}
			
			function chooseLineSize(num)
			// determines how thick a line representing a person should be, based
			// on how many times they appear on the chart
			{
				var lineSize = 0;
	
				if (num > 20) // appears more than 20 times
				{
					//lineSize = 6;
					lineSize = 12;
				}
				else if (num > 15) // appears more than 15 times and less than 20
				{
					//lineSize = 5;
					lineSize = 10;
				}
				else if (num > 10) // appears more than 10 times and less than 15
				{
					//lineSize = 4;
					lineSize = 8;
				}
				else if (num > 5) // appears more than 5 times and less than 10
				{
					//lineSize = 3;
					lineSize = 6;
				}
				else // appears less than 5 times
				{
					lineSize = 2;
				}
				return lineSize; 
			}
			
			function getLineColor(arr, min, max, y)
			{
				var numYears = max-min;
				cutoff1 = parseInt(min) + parseInt((numYears/4));
				cutoff2 = parseInt(min) + parseInt(numYears*(2/4));
				cutoff3 = parseInt(min) + parseInt(numYears*(3/4));
					
				adder = 255/(numYears/4);
					
				if (y>cutoff3)
				{
					arr[8] = 0;
					arr[13] = arr[13] + adder;
					arr[3] = 0;
					arr[0] = arr[3];
					arr[10] = arr[13];
					arr[5] = arr[8];
				}
				else if (y>cutoff2)
				{
					arr[9] = arr[9] + adder/2;
					arr[14] = arr[14] + adder/7;
					arr[4] = 0;
					arr[0] = arr[4];
					arr[10] = arr[14];
					arr[5] = arr[9];
				}
				else if (y>cutoff1)
				{
					arr[2] = 0;
					arr[7] = arr[7] + adder;
					arr[12] = 0;
					arr[0] = arr[2];
					arr[10] = arr[12];
					arr[5] = arr[7];
				}
				else
				{
					arr[1] = arr[1] + adder;
					arr[6] = 0
					arr[11] = 0;
					arr[0] = arr[1];
					arr[10] = arr[11];
					arr[5] = arr[6];
				}
				return arr;
			}

            function graphData()
			{
				var dataset = []
				//dataset contains array of arrays of rank/year data
	            for (var i = 0; i < fieldvalues.length; i++)
	            {
	                dataset.push(fieldvalues[i][fieldvalues[0].length-1]);
	            }
				
				//find the max year in the data, this is the max x value
				var maxx = d3.max(dataset, function (ms) {return d3.max(ms, function (d) {return d[0]})});
				//find the min year in the data, this is the min x value
				var minx = d3.min(dataset, function (ms) {return d3.min(ms, function (d) {return d[0]})});
				
				//x scale goes from min year to max year
				var x = d3.scale.linear().domain([minx,maxx]).range([0, (maxx-minx)*60]);
				var y = d3.scale.linear().domain([1, 10]).range([0, 400]);
				
				//define how to graph a line
				var line = d3.svg.line()
				// assign the X function to plot our line as we wish
					.x(function(d) { 
				// return the X coordinate where we want to plot this datapoint (return year)
						return x(d[0]); })
					.y(function(d) { 
				// verbose logging to show what's actually being done
				//console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
						return y(d[1]); })
			
				// Define container
				var chart = d3.select("body")
					.append("svg")
					.attr("class", "chart")
						//width is just larger than x-axis
					.attr("width", (maxx-minx)*62)
					.attr("height", 500)
					.append("g")
						// move 0,0 slightly down and right to accomodate axes
					.attr("transform", "translate(30,20)");
			 
				// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
			 
				// Draw Y-axis grid lines
				chart.selectAll("line.y")
					.data(y.ticks(10))
					.enter().append("line")
					.attr("class", "y")
					.attr("x1", 0)
					.attr("x2", (maxx-minx)*60)
					.attr("y1", y)
					.attr("y2", y)
					.style("stroke", "#ccc");
			 
				// Define stock x and y axis
																	//don't show comma for thousands b/c years
				var xAxis = d3.svg.axis().scale(x).orient('bottom').tickFormat(d3.format("04d"));
				var yAxis = d3.svg.axis().scale(y).orient('left');
			 
				//append x-axis
				chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,400)");
				//append y-axis
				chart.append('g')
				    .attr("class", "axis")
					.call(yAxis);
			  
			  
				//graph all entries in dataset as a line, set color
				//starting_colors = [red, red1, red2, red3, red4, green, green1, green2, green3, green4, blue, blue1, blue2, blue3, blue4]
				starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						year = fieldvalues[i][fieldvalues[0].length-1][0][0];
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					
					
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size).attr('stroke', linecolor);
					var point = chart.append("g")
							.attr("class", "line-point");

					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
			}
			
			function graphDataNoCross()
			{
				var dataset = []
				//dataset contains array of arrays of rank/year data
	            for (var i = 0; i < fieldvalues.length; i++)
	            {
	                dataset.push(fieldvalues[i][fieldvalues[0].length-1]);
	            }
				
				//find the max year in the data, this is the max x value
				var maxx = d3.max(dataset, function (ms) {return d3.max(ms, function (d) {return d[0]})});
				//find the min year in the data, this is the min x value
				var minx = d3.min(dataset, function (ms) {return d3.min(ms, function (d) {return d[0]})});
				
				//x scale goes from min year to max year
				var x = d3.scale.linear().domain([minx,maxx]).range([0, (maxx-minx)*60]);
				var y = d3.scale.linear().domain([1, 10]).range([0, 400]);
				
				//define how to graph a line
				var line = d3.svg.line()
				.defined(function(d) { return d[1] != null; })
				// assign the X function to plot our line as we wish
					.x(function(d) { 
				// return the X coordinate where we want to plot this datapoint (return year)
						return x(d[0]); })
					.y(function(d) { 
				// verbose logging to show what's actually being done
				//console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
						return y(d[1]); })
			
				// Define container
				var chart = d3.select("body")
					.append("svg")
					.attr("class", "chart")
						//width is just larger than x-axis
					.attr("width", (maxx-minx)*62)
					.attr("height", 500)
					.append("g")
						// move 0,0 slightly down and right to accomodate axes
					.attr("transform", "translate(30,20)");
			 
				// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
			 
				// Draw Y-axis grid lines
				chart.selectAll("line.y")
					.data(y.ticks(10))
					.enter().append("line")
					.attr("class", "y")
					.attr("x1", 0)
					.attr("x2", (maxx-minx)*60)
					.attr("y1", y)
					.attr("y2", y)
					.style("stroke", "#ccc");
			 
				// Define stock x and y axis
																	//don't show comma for thousands b/c years
				var xAxis = d3.svg.axis().scale(x).orient('bottom').tickFormat(d3.format("04d"));
				var yAxis = d3.svg.axis().scale(y).orient('left');
			 
				//append x-axis
				chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,403)");
				//append y-axis
				chart.append('g')
				    .attr("class", "axis")
					.call(yAxis);
			  
			  
				//graph all entries in dataset as a line, set color
				//starting_colors = [red, red1, red2, red3, red4, green, green1, green2, green3, green4, blue, blue1, blue2, blue3, blue4]
				starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						for(var k = 0; k< fieldvalues[i][fieldvalues[0].length-1].length;k++)
						{
							if(fieldvalues[i][fieldvalues[0].length-1][k][1] != null)
							{
							   year = fieldvalues[i][fieldvalues[0].length-1][k][0];
							   break;
							}
						}
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size).attr('stroke', linecolor);
					var point = chart.append("g")
							.attr("class", "line-point");

					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
			}
			
			
			function graphDataZoom(dataset, maxx, minx, x)
			{


				var y = d3.scale.linear().domain([1, 10]).range([0, 400]);
				
				//define how to graph a line
				var line = d3.svg.line()
				// assign the X function to plot our line as we wish
					.x(function(d) { 
				// return the X coordinate where we want to plot this datapoint (return year)
						return x(d[0]); })
					.y(function(d) { 
				// verbose logging to show what's actually being done
				//console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
						return y(d[1]); })
			
				// Define container
				var chart = d3.select("body")
					.append("svg")
					.attr("class", "chart")
						//width is just larger than x-axis
					.attr("width", 1350)
					.attr("height", 550)
					.append("g")
						// move 0,0 slightly down and right to accomodate axes
					.attr("transform", "translate(30,20)");
				
				chart.append("defs").append("clipPath")
						.attr("id", "clip")
						.append("rect")
						.attr("width", 1300)
						.attr("height", 550);
			 
				// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
			 
				// Draw Y-axis grid lines
				chart.selectAll("line.y")
					.data(y.ticks(10))
					.enter().append("line")
					.attr("class", "y")
					.attr("x1", 0)
					.attr("x2", 1300)
					.attr("y1", y)
					.attr("y2", y)
					.style("stroke", "#ccc");
			 
				// Define stock x and y axis
																	//don't show comma for thousands b/c years
				var xAxis = d3.svg.axis().scale(x).orient('bottom').tickFormat(d3.format("04d"));
				var yAxis = d3.svg.axis().scale(y).orient('left');
			 
				//append x-axis
				chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,400)").attr("id", "chartxaxis");
				//append y-axis
				chart.append('g')
				    .attr("class", "axis")
					.call(yAxis);
			  
			  var navWidth = 1300,
					navHeight = 100;
					
				var navChart = d3.select('body').classed('chart', true).append('svg')
								.classed('navigator', true)
								.attr('width', navWidth)
								.attr('height', 300)
								.append('g')
								.attr('transform', 'translate(' + 30 + ',' + 30 + ')');
				//navChart.attr('transform', 'translate(0,0)');

				var navXScale = d3.scale.linear()
						.domain([minx, maxx])
						.range([0, 1300]),
					navYScale = d3.scale.linear()
						.domain([1, 10])
						.range([0, navHeight]);
						
				var navXAxis = d3.svg.axis().scale(navXScale).orient('bottom').tickFormat(d3.format("04d"));;

				navChart.append('g')
						.attr('class', 'x axis')
						.attr('transform', 'translate(0,' + 80 + ')')
						.call(navXAxis);
						
				var navData = d3.svg.area()
					    .x(function (d) { return navXScale(d[0]); })
					    .y0(navHeight)
					    .y1(function (d) { return navYScale(d[1]); });
						
				var navLine = d3.svg.line()
						.x(function (d) { return navXScale(d[0]); })
						.y(function (d) { return navYScale(d[1]); });
								
								
				//graph all entries in dataset as a line, set color
				//starting_colors = [red, red1, red2, red3, red4, green, green1, green2, green3, green4, blue, blue1, blue2, blue3, blue4]
				starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						year = fieldvalues[i][fieldvalues[0].length-1][0][0];
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					
					navChart.append('nav:path')
						.attr('class', 'data')
						.attr("transform", "translate(0,-21)")
						.attr('d', navData(dataset[i]));
						
					navChart.append('nav:path')
						.attr('class', 'line')
						.attr("transform", "translate(0,-21)")
						.attr('d', navLine(dataset[i]));
					
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size)
							.attr('stroke', linecolor).attr("id", "chartline");
					var point = chart.append("g")
							.attr("class", "line-point");

					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
				
				var viewport = d3.svg.brush()
					.x(navXScale)
					.on("brush", brushed);
					function brushed() {
						x.domain(viewport.empty() ? navXScale.domain() : viewport.extent());
						d3.selectAll("circle").remove();
						d3.selectAll("#chartline").remove();
						d3.selectAll("#chartxaxis").remove();
						d3.selectAll("line.x").remove();
						
						starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						year = fieldvalues[i][fieldvalues[0].length-1][0][0];
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					
					chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,400)").attr("id", "chartxaxis");
					
					// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
					
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size)
							.attr('stroke', linecolor).attr("clip-path", "url(#clip)").attr("id", "chartline");
					var point = chart.append("g")
							.attr("class", "line-point");
				
					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
						
						
						
						
					};
				navChart.append("g")
				.attr("class", "viewport")
				.call(viewport)
				.selectAll("rect")
				.attr("transform", "translate(0,-21)")
				.attr("height", navHeight);

			}
			
			
			function graphDataNoCrossZoom(dataset, maxx, minx, x)
			{
				var y = d3.scale.linear().domain([1, 10]).range([0, 400]);
				
				//define how to graph a line
				var line = d3.svg.line()
				.defined(function(d) { return d[1] != null; })
				// assign the X function to plot our line as we wish
					.x(function(d) { 
				// return the X coordinate where we want to plot this datapoint (return year)
						return x(d[0]); })
					.y(function(d) { 
				// verbose logging to show what's actually being done
				//console.log('Plotting Y value for data point: ' + d + ' to be at: ' + y(d) + " using our yScale.");
				// return the Y coordinate where we want to plot this datapoint
						return y(d[1]); })
			
				// Define container
				var chart = d3.select("body")
					.append("svg")
					.attr("class", "chart")
						//width is just larger than x-axis
					.attr("width", 1350)
					.attr("height", 550)
					.append("g")
						// move 0,0 slightly down and right to accomodate axes
					.attr("transform", "translate(30,20)");
			 
				// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
					
					chart.append("defs").append("clipPath")
						.attr("id", "clip")
						.append("rect")
						.attr("width", 1300)
						.attr("height", 550);
			 
				// Draw Y-axis grid lines
				chart.selectAll("line.y")
					.data(y.ticks(10))
					.enter().append("line")
					.attr("class", "y")
					.attr("x1", 0)
					.attr("x2", 1300)
					.attr("y1", y)
					.attr("y2", y)
					.style("stroke", "#ccc");
			 
				// Define stock x and y axis
																	//don't show comma for thousands b/c years
				var xAxis = d3.svg.axis().scale(x).orient('bottom').tickFormat(d3.format("04d"));
				var yAxis = d3.svg.axis().scale(y).orient('left');
			 
				//append x-axis
				chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,400)").attr("id", "chartxaxis");
				//append y-axis
				chart.append('g')
				    .attr("class", "axis")
					.call(yAxis);
					
					var navWidth = 1300,
					navHeight = 100;
					
				var navChart = d3.select('body').classed('chart', true).append('svg')
								.classed('navigator', true)
								.attr('width', navWidth)
								.attr('height', 300)
								.append('g')
								.attr('transform', 'translate(' + 30 + ',' + 30 + ')');
				//navChart.attr('transform', 'translate(0,0)');

				var navXScale = d3.scale.linear()
						.domain([minx, maxx])
						.range([0, 1300]),
					navYScale = d3.scale.linear()
						.domain([1, 10])
						.range([0, navHeight]);
						
				var navXAxis = d3.svg.axis().scale(navXScale).orient('bottom').tickFormat(d3.format("04d"));;

				navChart.append('g')
						.attr('class', 'x axis')
						.attr('transform', 'translate(0,' + 80 + ')')
						.call(navXAxis);
						
				var navData = d3.svg.area()
						.defined(function(d) { return d[1] != null; })
					    .x(function (d) { return navXScale(d[0]); })
					    .y0(navHeight)
					    .y1(function (d) { return navYScale(d[1]); });
						
				var navLine = d3.svg.line()
						.defined(function(d) { return d[1] != null; })
						.x(function (d) { return navXScale(d[0]); })
						.y(function (d) { return navYScale(d[1]); });
								
			  
			  
				//graph all entries in dataset as a line, set color
				//starting_colors = [red, red1, red2, red3, red4, green, green1, green2, green3, green4, blue, blue1, blue2, blue3, blue4]
				starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						for(var k = 0; k< fieldvalues[i][fieldvalues[0].length-1].length;k++)
						{
							if(fieldvalues[i][fieldvalues[0].length-1][k][1] != null)
							{
							   year = fieldvalues[i][fieldvalues[0].length-1][k][0];
							   break;
							}
						}
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					
					navChart.append('nav:path')
						.attr('class', 'data')
						.attr("transform", "translate(0,-21)")
						.attr('d', navData(dataset[i]));
						
					navChart.append('nav:path')
						.attr('class', 'line')
						.attr("transform", "translate(0,-21)")
						.attr('d', navLine(dataset[i]));
					
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size)
						.attr('stroke', linecolor)
							.attr("id", "chartline");
					var point = chart.append("g")
							.attr("class", "line-point");

					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
				var viewport = d3.svg.brush()
					.x(navXScale)
					.on("brush", brushed);
					function brushed() {
						x.domain(viewport.empty() ? navXScale.domain() : viewport.extent());
						d3.selectAll("circle").remove();
						d3.selectAll("#chartline").remove();
						d3.selectAll("#chartxaxis").remove();
						d3.selectAll("line.x").remove();
						
						starting_colors = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				for(var i = 0; i < dataset.length; i++)
				{
					rankcount = 0;
					for(var j = 0; j < fieldvalues[i][fieldvalues[0].length-1].length;j++)
					{
						if (fieldvalues[i][fieldvalues[0].length-1][j][1] != null)
						{
							rankcount++;
						}
					}
					if (lineThickness)
					{
						line_size = chooseLineSize(rankcount);
					}
					else
					{
						line_size = 3;
					}
					if (colorByYear)
					{
						for(var k = 0; k< fieldvalues[i][fieldvalues[0].length-1].length;k++)
						{
							if(fieldvalues[i][fieldvalues[0].length-1][k][1] != null)
							{
							   year = fieldvalues[i][fieldvalues[0].length-1][k][0];
							   break;
							}
						}
						starting_colors = getLineColor(starting_colors, minx, maxx, year);
						linecolor = "rgb("+Math.round(starting_colors[0])+","+Math.round(starting_colors[5])+","+Math.round(starting_colors[10])+")";
					}
					else
					{
						linecolor = "black";
					}
					
					chart.append('g')
					.attr("class", "axis")
					.call(xAxis)
					//translate x-axis to bottom of chart
					.attr("transform", "translate(0,400)").attr("id", "chartxaxis");
					
					// Draw X-axis grid lines
				chart.selectAll("line.x")
					.data(x.ticks(10))
					.enter().append("line")
					.attr("class", "x")
					.attr("x1", x)
					.attr("x2", x)
					.attr("y1", 0)
					.attr("y2", 400)
					.style("stroke", "#ccc");
					
					chart.append("svg:path").attr("d", line(dataset[i])).attr('stroke-width', line_size)
							.attr('stroke', linecolor)
							.attr("clip-path", "url(#clip)").attr("id", "chartline");
					var point = chart.append("g")
							.attr("class", "line-point");
				
					point.selectAll('circle')
							.data(function(d){ return dataset[i]})
							.enter().append('circle')
							.attr("cx", function(d) { return x(d[0]) })
							.attr("cy", function(d) { return y(d[1]) })
							.attr("r", 2.5)
							.style("fill", linecolor)
				}
						
						
						
						
					};
				navChart.append("g")
				.attr("class", "viewport")
				.call(viewport)
				.selectAll("rect")
				.attr("transform", "translate(0,-21)")
				.attr("height", navHeight);

			}
			
			function setup()
			{
				dataset = []
				//dataset contains array of arrays of rank/year data
	            for (var i = 0; i < fieldvalues.length; i++)
	            {
	                dataset.push(fieldvalues[i][fieldvalues[0].length-1]);
	            }
				
				//find the max year in the data, this is the max x value
				maxx = d3.max(dataset, function (ms) {return d3.max(ms, function (d) {return d[0]})});
				//find the min year in the data, this is the min x value
				minx = d3.min(dataset, function (ms) {return d3.min(ms, function (d) {return d[0]})});
								//x scale goes from min year to max year
				x = d3.scale.linear().domain([minx,maxx]).range([0, 1300]);
			}
			
			loadAttributeFile();
			loadRankingData();
			graphData();
			
              
			$(window).load(function(){
     $(function(){
         $("#coloryear").on("click", function(event){
          colorByYear = !colorByYear;
			d3.selectAll("svg").remove();
            loadAttributeFile();
			if (dontCross)
			{
				if (dontscroll)
				{
					loadRankingDataNoCross();
					setup();
					graphDataNoCrossZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingDataNoCross();
					graphDataNoCross();
				}
			}
			else
			{
				if (dontscroll)
				{
					loadRankingData();
					setup();
					graphDataZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingData();
					graphData();
				}
			}
         })
     })
});
			
			$(window).load(function(){
     $(function(){
         $("#linethick").on("click", function(event){
          lineThickness = !lineThickness;
			d3.selectAll("svg").remove();
            loadAttributeFile();
			if (dontCross)
			{
				if (dontscroll)
				{
					loadRankingDataNoCross();
					setup();
					graphDataNoCrossZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingDataNoCross();
					graphDataNoCross();
				}
			}
			else
			{
				if (dontscroll)
				{
					loadRankingData();
					setup();
					graphDataZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingData();
					graphData();
				}
			}
         })
     })
});
			
			$(window).load(function(){
     $(function(){
         $("#crossing").on("click", function(event){
          dontCross = !dontCross;
			d3.selectAll("svg").remove();
            loadAttributeFile();
			if (dontCross)
			{
				if (dontscroll)
				{
					loadRankingDataNoCross();
					setup();
					graphDataNoCrossZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingDataNoCross();
					graphDataNoCross();
				}
			}
			else
			{
				if (dontscroll)
				{
					loadRankingData();
					setup();
					graphDataZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingData();
					graphData();
				}
			}
         })
     })
});
			
			$(window).load(function(){
     $(function(){
         $("#scrolling").on("click", function(event){
          dontscroll = !dontscroll;
			d3.selectAll("svg").remove();
            loadAttributeFile();
			if (dontCross)
			{
				if (dontscroll)
				{
					loadRankingDataNoCross();
					setup();
					graphDataNoCrossZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingDataNoCross();
					graphDataNoCross();
				}
			}
			else
			{
				if (dontscroll)
				{
					loadRankingData();
					setup();
					graphDataZoom(dataset, maxx, minx, x);
				}
				else
				{
					loadRankingData();
					graphData();
				}
			}
         })
     })
});
  
		</script>
    </body>
</html>